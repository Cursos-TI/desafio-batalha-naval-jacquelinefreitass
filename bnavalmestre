#include <stdio.h>
#include <stdlib.h> 

#define TAMANHO_TABULEIRO 10
#define TAMANHO_NAVIO 3
#define TAMANHO_HABILIDADE 5 

#define AGUA 0
#define NAVIO 3 
#define EFEITO_HABILIDADE 5

#define HORIZONTAL 0
#define VERTICAL 1
#define DIAG_DESCENDO_DIREITA 2
#define DIAG_SUBINDO_DIREITA 3

int posicionarNavio(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO], int linha, int coluna, int tamanho, int orientacao);
void exibirTabuleiro(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO]);

void criarHabilidadeCone(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]);
void criarHabilidadeCruz(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]);
void criarHabilidadeOctaedro(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]);
void aplicarHabilidade(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO], 
                         int hab[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE], 
                         int origem_linha, int origem_coluna);
void exibirMatrizHabilidade(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]);

int main() {

    int tabuleiro[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO];
    int i, j;

    for (i = 0; i < TAMANHO_TABULEIRO; i++) {
        for (j = 0; j < TAMANHO_TABULEIRO; j++) {
            tabuleiro[i][j] = AGUA;
        }
    }

    printf("Posicionando navios...\n");
    posicionarNavio(tabuleiro, 1, 1, TAMANHO_NAVIO, HORIZONTAL);
    posicionarNavio(tabuleiro, 3, 8, TAMANHO_NAVIO, VERTICAL);
    posicionarNavio(tabuleiro, 3, 1, TAMANHO_NAVIO, DIAG_DESCENDO_DIREITA);
    posicionarNavio(tabuleiro, 8, 4, TAMANHO_NAVIO, DIAG_SUBINDO_DIREITA);
    
    printf("Navios posicionados.\n\n");

    int habilidade_cone[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE];
    int habilidade_cruz[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE];
    int habilidade_octaedro[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE];

    criarHabilidadeCone(habilidade_cone);
    criarHabilidadeCruz(habilidade_cruz);
    criarHabilidadeOctaedro(habilidade_octaedro);

    printf("--- Matriz Habilidade CONE (5x5) ---\n");
    exibirMatrizHabilidade(habilidade_cone);
    
    printf("\n--- Matriz Habilidade CRUZ (5x5) ---\n");
    exibirMatrizHabilidade(habilidade_cruz);
    
    printf("\n--- Matriz Habilidade OCTAEDRO (5x5) ---\n");
    exibirMatrizHabilidade(habilidade_octaedro);

    printf("\nAplicando habilidades ao tabuleiro...\n");
    
    aplicarHabilidade(tabuleiro, habilidade_cone, 2, 5); 
    aplicarHabilidade(tabuleiro, habilidade_cruz, 5, 2); 
    aplicarHabilidade(tabuleiro, habilidade_octaedro, 7, 7);

    printf("Habilidades aplicadas.\n\n");

    exibirTabuleiro(tabuleiro);
    
    return 0; 
}

void exibirTabuleiro(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO]) {
    printf("--- Tabuleiro Batalha Naval (10x10) ---\n");
    
    printf("  "); 
    for(int k=0; k < TAMANHO_TABULEIRO; k++) {
        printf("%d ", k);
    }
    printf("\n");

    for (int i = 0; i < TAMANHO_TABULEIRO; i++) { 
        printf("%d ", i); 
        for (int j = 0; j < TAMANHO_TABULEIRO; j++) { 
            
            switch (tab[i][j]) {
                case AGUA:
                    printf("~ "); 
                    break;
                case NAVIO:
                    printf("N "); 
                    break;
                case EFEITO_HABILIDADE:
                    printf("* "); 
                    break;
                default:
                    printf("%d ", tab[i][j]); 
            }
        }
        printf("\n"); 
    }
    
    printf("\nLegenda: ~ = Água | N = Navio | * = Área de Efeito\n");
}

void exibirMatrizHabilidade(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]) {
    for (int i = 0; i < TAMANHO_HABILIDADE; i++) {
        for (int j = 0; j < TAMANHO_HABILIDADE; j++) {
            printf("%d ", mat[i][j]);
        }
        printf("\n");
    }
}

void criarHabilidadeCone(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]) {
    int centro_col = TAMANHO_HABILIDADE / 2; 

    for (int i = 0; i < TAMANHO_HABILIDADE; i++) {
        for (int j = 0; j < TAMANHO_HABILIDADE; j++) {
            
            if (abs(j - centro_col) <= i) {
                mat[i][j] = 1; 
            } else {
                mat[i][j] = 0; 
            }
        }
    }
}

void criarHabilidadeCruz(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]) {
    int centro = TAMANHO_HABILIDADE / 2; 

    for (int i = 0; i < TAMANHO_HABILIDADE; i++) {
        for (int j = 0; j < TAMANHO_HABILIDADE; j++) {
            
            if (i == centro || j == centro) {
                mat[i][j] = 1; 
            } else {
                mat[i][j] = 0; 
            }
        }
    }
}

void criarHabilidadeOctaedro(int mat[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE]) {
    int centro = TAMANHO_HABILIDADE / 2; 

    for (int i = 0; i < TAMANHO_HABILIDADE; i++) {
        for (int j = 0; j < TAMANHO_HABILIDADE; j++) {
            
            int dist_i = abs(i - centro);
            int dist_j = abs(j - centro);

            if ((dist_i + dist_j) <= centro) {
                mat[i][j] = 1; 
            } else {
                mat[i][j] = 0; 
            }
        }
    }
}

void aplicarHabilidade(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO], 
                         int hab[TAMANHO_HABILIDADE][TAMANHO_HABILIDADE], 
                         int origem_linha, int origem_coluna) {
    
    int centro_hab = TAMANHO_HABILIDADE / 2;

    for (int i = 0; i < TAMANHO_HABILIDADE; i++) {
        for (int j = 0; j < TAMANHO_HABILIDADE; j++) {
            
            if (hab[i][j] == 1) {
                
                int tab_linha = origem_linha + (i - centro_hab);
                int tab_coluna = origem_coluna + (j - centro_hab);

                if (tab_linha >= 0 && tab_linha < TAMANHO_TABULEIRO &&
                    tab_coluna >= 0 && tab_coluna < TAMANHO_TABULEIRO) 
                {
                    tab[tab_linha][tab_coluna] = EFEITO_HABILIDADE;
                }
            }
        }
    }
}

int posicionarNavio(int tab[TAMANHO_TABULEIRO][TAMANHO_TABULEIRO], int linha, int coluna, int tamanho, int orientacao) {
    
    int i;
    
    for (i = 0; i < tamanho; i++) {
        int l = linha; 
        int c = coluna; 
        
        if (orientacao == HORIZONTAL) {
            c += i;
        } else if (orientacao == VERTICAL) {
            l += i;
        } else if (orientacao == DIAG_DESCENDO_DIREITA) {
            l += i;
            c += i;
        } else if (orientacao == DIAG_SUBINDO_DIREITA) {
            l -= i; 
            c += i; 
        }
        
        if (l < 0 || l >= TAMANHO_TABULEIRO || c < 0 || c >= TAMANHO_TABULEIRO) {
            return 0; 
        }
        
        if (tab[l][c] == NAVIO) {
            return 0; 
        }
    }
    
    for (i = 0; i < tamanho; i++) {
        int l = linha;
        int c = coluna;
        
        if (orientacao == HORIZONTAL) {
            c += i;
        } else if (orientacao == VERTICAL) {
            l += i;
        } else if (orientacao == DIAG_DESCENDO_DIREITA) {
            l += i;
            c += i;
        } else if (orientacao == DIAG_SUBINDO_DIREITA) {
            l -= i;
            c += i;
        }
        
        tab[l][c] = NAVIO;
    }
    
    return 1; 
}
